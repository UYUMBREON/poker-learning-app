# 学習アプリ

Dockerを用いた再現可能な学習管理アプリケーションです。

## 機能

- ✅ ページタイトル入力
- ✅ タグ付け機能
- ✅ ページ保存機能
- ✅ Markdown形式文字列入力機能
- ✅ 学習ページまとめ画面（テーブル形式一覧）
- ✅ タグによる検索・フィルター機能
- ✅ ページタイトルによる検索機能
- ✅ **タグ管理機能（作成・編集・削除）**
- ✅ **カラーパレット付きタグ作成**
- ✅ **リアルタイムタグ連携**
- ✅ Dockerによる環境再現性

## 技術スタック

- **フロントエンド**: React 18, React Router, Lucide React
- **バックエンド**: Node.js, Express
- **データベース**: PostgreSQL
- **コンテナ**: Docker, Docker Compose

## セットアップ

### 前提条件
- Docker
- Docker Compose

### 起動手順

1. **プロジェクトをクローン**
```bash
git clone <repository-url>
cd learning-app
```

2. **ディレクトリ構造を作成**
```
learning-app/
├── docker-compose.yml
├── database/
│   └── init.sql
├── backend/
│   ├── Dockerfile
│   ├── package.json
│   └── server.js
├── frontend/
│   ├── Dockerfile
│   ├── package.json
│   ├── public/
│   │   └── index.html
│   └── src/
│       ├── index.js
│       ├── index.css
│       ├── App.js
│       ├── App.css
│       └── components/
│           ├── Header.js
│           ├── PageList.js
│           ├── PageEditor.js
│           ├── PageViewer.js
│           ├── PageSummary.js
│           ├── TagManager.js
│           └── TagSelector.js
└── README.md
```

3. **Docker Composeで起動**
```bash
docker-compose up --build
```

4. **ブラウザでアクセス**
- フロントエンド: http://localhost:3000
- バックエンドAPI: http://localhost:3001

## 使用方法

### 基本操作

1. **ページ作成**
   - ホーム画面で「新しいページを作成」をクリック
   - ページタイトルを入力

2. **内容の入力**
   - テキストエリアにページ内容をMarkdown形式で記入
   - プレビューモードで表示を確認可能

3. **タグ付け**
   - 下部のタグセクションでタグを選択
   - 複数のタグを組み合わせ可能

4. **保存**
   - 「保存」ボタンをクリックしてページを保存

### 🆕 タグ管理機能の使用方法

#### タグ管理画面へのアクセス
- ヘッダーの「タグ管理」ボタンをクリック
- 専用ページ (`/tags`) でタグの一元管理が可能

#### 新しいタグの作成
1. **作成の開始**
   - 「新規作成」ボタンをクリックして作成フォームを展開

2. **タグ情報の入力**
   - **タグ名**: 最大20文字まで入力可能
   - **色の選択**: 12色のカラーパレットから選択
     - 赤 (#EF4444) - 数学、重要な内容など
     - 緑 (#10B981) - プログラミング、技術系など
     - 青 (#3B82F6) - 基本・デフォルト
     - 紫 (#8B5CF6) - 言語学習など
     - その他8色のカラーバリエーション

3. **プレビュー確認**
   - 入力内容がリアルタイムでプレビュー表示
   - 色とテキストの組み合わせを事前確認

4. **作成の完了**
   - 「タグを作成」ボタンで保存
   - 重複チェック機能により同名タグの作成を防止

#### タグの編集
1. **編集モードへの切り替え**
   - 各タグカードの「編集」ボタン（鉛筆アイコン）をクリック

2. **タグ情報の変更**
   - タグ名の変更（インライン入力）
   - カラーパレットから新しい色を選択
   - 変更内容のリアルタイムプレビュー

3. **変更の保存**
   - 「保存」ボタン（チェックアイコン）で確定
   - 「キャンセル」ボタン（×アイコン）で変更を破棄

#### タグの削除
1. **削除の実行**
   - 各タグカードの「削除」ボタン（ゴミ箱アイコン）をクリック

2. **確認ダイアログ**
   - 削除確認メッセージが表示
   - 関連付けられたページからも自動的に削除される旨を通知

3. **安全な削除処理**
   - 確認後、タグとすべての関連付けを削除
   - データベースの整合性を保持

#### 自動連携機能
- **ページ編集画面**: 新しく作成したタグが即座に選択可能
- **まとめ画面**: 絞り込みフィルターに最新のタグが反映
- **ページ一覧**: 編集されたタグの色や名前が自動更新

### 学習ページまとめ画面の使用方法

1. **まとめ画面へのアクセス**
   - ヘッダーの「まとめ」ボタンをクリック
   - 全ての学習ページがテーブル形式で表示されます

2. **ページタイトルによる検索**
   - 上部の検索ボックスにキーワードを入力
   - ページタイトルに部分一致するページが絞り込まれます
   - 検索ボックス右側の×ボタンで検索をクリア

3. **タグによる絞り込み**
   - 「タグで絞り込み」セクションでタグボタンをクリック
   - 複数のタグを選択可能（OR条件で絞り込み）
   - 選択されたタグは色が変わり、アクティブ状態を表示
   - **最新のタグが自動的に反映**

4. **フィルターの組み合わせ**
   - タイトル検索とタグ絞り込みを同時に使用可能
   - 「フィルターをクリア」ボタンで全ての絞り込み条件をリセット

5. **結果の確認**
   - 絞り込み結果の件数が表示されます
   - テーブルには以下の情報が表示されます：
     - ページタイトル（リンク付き）
     - 関連付けられたタグ
     - 作成日
     - 更新日
     - 編集リンク

6. **ページ編集**
   - タイトルリンクまたは「編集」リンクをクリックしてページ編集画面へ移動

## 画面構成

### 1. ホーム画面 (`/`)
- 学習ページ一覧をカード形式で表示
- 各ページのタイトル、内容プレビュー、タグ、更新日を表示
- 新規ページ作成ボタン

### 2. まとめ画面 (`/summary`)
- 全学習ページをテーブル形式で一覧表示
- タイトル検索機能
- タグによる絞り込み機能
- 検索結果件数表示

### 3. 🆕 タグ管理画面 (`/tags`)
- **タグ一覧表示**: 全てのタグをカード形式で表示
- **新規タグ作成**: 折りたたみ式の作成フォーム
- **インライン編集**: その場でタグ名と色を編集
- **安全な削除**: 確認ダイアログ付きの削除機能
- **カラーパレット**: 12色から選択可能
- **リアルタイムプレビュー**: 作成・編集時の即座のプレビュー
- **レスポンシブ対応**: モバイルデバイスでも快適な操作

### 4. ページ編集画面 (`/page/new`, `/page/:id`)
- ページタイトル入力
- 内容入力エリア（Markdown対応）
- プレビューモード切り替え
- タグ選択機能（**最新のタグが自動反映**）
- 保存・削除ボタン

### 5. ページ閲覧画面 (`/page/:id`)
- ページタイトル表示
- Markdown形式コンテンツの表示
- タグ表示
- 編集ボタン

## データベース構造

### pages テーブル
- `id`: 主キー
- `title`: ページタイトル
- `content`: ページ内容（Markdown形式）
- `created_at`: 作成日時
- `updated_at`: 更新日時

### tags テーブル
- `id`: 主キー
- `name`: タグ名（**UNIQUE制約**）
- `color`: タグの色（16進数カラーコード）
- `created_at`: 作成日時

### page_tags テーブル
- `id`: 主キー
- `page_id`: ページID（外部キー、CASCADE削除）
- `tag_id`: タグID（外部キー、CASCADE削除）
- **UNIQUE制約**: (page_id, tag_id)の組み合わせ

## API エンドポイント

### ページ関連
- `GET /api/pages` - ページ一覧取得（タグ情報含む）
- `GET /api/pages/:id` - 特定ページ取得（タグ情報含む）
- `POST /api/pages` - ページ作成
- `PUT /api/pages/:id` - ページ更新
- `DELETE /api/pages/:id` - ページ削除

### タグ関連
- `GET /api/tags` - タグ一覧取得
- `POST /api/tags` - タグ作成
- 🆕 `PUT /api/tags/:id` - **タグ更新**
- 🆕 `DELETE /api/tags/:id` - **タグ削除**

### 🆕 新しいAPI機能
- **重複チェック**: タグ名の一意性を保証
- **関連データ整合性**: タグ削除時のpage_tags自動削除
- **エラーハンドリング**: 詳細なエラーメッセージ返却

## 開発

### 開発モードでの起動
```bash
# バックエンドのみ起動（開発用）
cd backend
npm install
npm run dev

# フロントエンドのみ起動（開発用）
cd frontend
npm install
npm start
```

### データベースの初期化
データベースは初回起動時に `database/init.sql` によって自動的に初期化されます。
初期データとして以下のタグが作成されます：
- 数学（赤色 #EF4444）
- プログラミング（緑色 #10B981）
- 英語（紫色 #8B5CF6）
- 物理（黄色 #F59E0B）
- 🆕 歴史（ピンク色 #EC4899）
- 🆕 化学（シアン色 #06B6D4）

## トラブルシューティング

### ポートが使用中の場合
```bash
# 使用中のポートを確認
lsof -i :3000
lsof -i :3001
lsof -i :5432

# Docker Composeを停止
docker-compose down
```

### データベース接続エラー
```bash
# コンテナの状態を確認
docker-compose ps

# データベースログを確認
docker-compose logs postgres
```

### データのリセット
```bash
# 全てのコンテナとボリュームを削除
docker-compose down -v
docker-compose up --build
```

### 🆕 タグ管理機能のトラブルシューティング

#### タグが表示されない場合
```bash
# バックエンドAPIの動作確認
curl http://localhost:3001/api/tags

# フロントエンドのログを確認
docker-compose logs frontend
```

#### タグの作成に失敗する場合
```bash
# データベースの制約を確認
docker-compose exec postgres psql -U user -d learning_app -c "SELECT * FROM tags;"

# 重複するタグ名がないかチェック
docker-compose exec postgres psql -U user -d learning_app -c "SELECT name, COUNT(*) FROM tags GROUP BY name HAVING COUNT(*) > 1;"
```

#### タグの削除に失敗する場合
```bash
# 関連するpage_tagsの確認
docker-compose exec postgres psql -U user -d learning_app -c "SELECT pt.*, t.name FROM page_tags pt JOIN tags t ON pt.tag_id = t.id WHERE t.id = [TAG_ID];"

# バックエンドAPIログの確認
docker-compose logs backend
```

### 検索・フィルター機能が動作しない場合
```bash
# フロントエンドのログを確認
docker-compose logs frontend

# バックエンドAPIの動作確認
curl http://localhost:3001/api/pages
curl http://localhost:3001/api/tags
```

## 🆕 新機能の特徴

### タグ管理機能の利点
- **一元管理**: 全てのタグを1箇所で管理
- **直感的UI**: カラーパレットによる視覚的な色選択
- **リアルタイム更新**: 変更が即座に全機能に反映
- **安全な操作**: 確認ダイアログと適切なエラーハンドリング
- **レスポンシブ対応**: デスクトップからモバイルまで対応

### 自動連携システム
- **即時反映**: タグの作成・編集・削除が全画面に自動反映
- **データ整合性**: データベースレベルでの整合性保証
- **ユーザビリティ**: 操作の手間を最小限に抑制

### まとめ画面の利点
- **効率的な管理**: 全ページを一覧で確認可能
- **高速検索**: タイトルやタグによる即座の絞り込み
- **視覚的整理**: テーブル形式による情報の構造化
- **レスポンシブ対応**: モバイルデバイスでも使いやすい表示

### 検索機能の特徴
- **リアルタイム検索**: 入力と同時に結果が更新
- **複合条件**: タイトル検索とタグ絞り込みの組み合わせ
- **直感的UI**: クリアボタンによる簡単リセット
- **件数表示**: 検索結果の数を明確に表示

## 🎯 推奨ワークフロー

### 効率的な学習管理のために

1. **初期設定**
   - まず「タグ管理」でよく使用する学習分野のタグを作成
   - 色分けで直感的に識別できるよう設定

2. **ページ作成時**
   - 適切なタグを付けて分類
   - Markdown形式で見やすく内容を記述

3. **学習の振り返り**
   - 「まとめ」画面でタグ別に学習進捗を確認
   - 検索機能で特定のトピックを素早く発見

4. **継続的改善**
   - 必要に応じてタグを追加・編集
   - 学習の進行に合わせてページ内容を更新

## ライセンス

MIT License