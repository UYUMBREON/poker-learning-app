# 学習アプリ

Dockerを用いた再現可能な学習管理アプリケーションです。

## 機能

- ✅ ページタイトル入力
- ✅ 樹形図作成機能（各ノードが章を表現）
- ✅ タグ付け機能
- ✅ ページ保存機能
- ✅ 文字列入力機能
- ✅ 学習ページまとめ画面（テーブル形式一覧）
- ✅ タグによる検索・フィルター機能
- ✅ ページタイトルによる検索機能
- ✅ Dockerによる環境再現性

## 技術スタック

- **フロントエンド**: React 18, React Router, Lucide React
- **バックエンド**: Node.js, Express
- **データベース**: PostgreSQL
- **コンテナ**: Docker, Docker Compose

## セットアップ

### 前提条件
- Docker
- Docker Compose

### 起動手順

1. **プロジェクトをクローン**
```bash
git clone <repository-url>
cd learning-app
```

2. **ディレクトリ構造を作成**
```
learning-app/
├── docker-compose.yml
├── database/
│   └── init.sql
├── backend/
│   ├── Dockerfile
│   ├── package.json
│   └── server.js
├── frontend/
│   ├── Dockerfile
│   ├── package.json
│   ├── public/
│   │   └── index.html
│   └── src/
│       ├── index.js
│       ├── index.css
│       ├── App.js
│       ├── App.css
│       └── components/
│           ├── Header.js
│           ├── PageList.js
│           ├── PageEditor.js
│           ├── PageSummary.js
│           └── TreeEditor.js
└── README.md
```

3. **Docker Composeで起動**
```bash
docker-compose up --build
```

4. **ブラウザでアクセス**
- フロントエンド: http://localhost:3000
- バックエンドAPI: http://localhost:3001

## 使用方法

### 基本操作

1. **ページ作成**
   - ホーム画面で「新しいページを作成」をクリック
   - ページタイトルを入力

2. **樹形図の作成**
   - 「ノード追加」ボタンでノードを追加
   - ノードをダブルクリックして名前を編集
   - 2つのノードを順番にクリックして接続
   - ドラッグでノードを移動

3. **内容の入力**
   - 右側のテキストエリアにページ内容を記入

4. **タグ付け**
   - 下部のタグセクションでタグを選択
   - 複数のタグを組み合わせ可能

5. **保存**
   - 「保存」ボタンをクリックしてページを保存

### 学習ページまとめ画面の使用方法

1. **まとめ画面へのアクセス**
   - ヘッダーの「まとめ」ボタンをクリック
   - 全ての学習ページがテーブル形式で表示されます

2. **ページタイトルによる検索**
   - 上部の検索ボックスにキーワードを入力
   - ページタイトルに部分一致するページが絞り込まれます
   - 検索ボックス右側の×ボタンで検索をクリア

3. **タグによる絞り込み**
   - 「タグで絞り込み」セクションでタグボタンをクリック
   - 複数のタグを選択可能（OR条件で絞り込み）
   - 選択されたタグは色が変わり、アクティブ状態を表示

4. **フィルターの組み合わせ**
   - タイトル検索とタグ絞り込みを同時に使用可能
   - 「フィルターをクリア」ボタンで全ての絞り込み条件をリセット

5. **結果の確認**
   - 絞り込み結果の件数が表示されます
   - テーブルには以下の情報が表示されます：
     - ページタイトル（リンク付き）
     - 関連付けられたタグ
     - 作成日
     - 更新日
     - 編集リンク

6. **ページ編集**
   - タイトルリンクまたは「編集」リンクをクリックしてページ編集画面へ移動

### 樹形図エディターの操作

- **ノード追加**: 「ノード追加」ボタン
- **ノード編集**: ノードをダブルクリック
- **ノード移動**: ドラッグ&ドロップ
- **ノード接続**: 2つのノードを順番にクリック
- **ノード削除**: ノードを選択して表示される×ボタン

## 画面構成

### 1. ホーム画面 (`/`)
- 学習ページ一覧をカード形式で表示
- 各ページのタイトル、内容プレビュー、タグ、更新日を表示
- 新規ページ作成ボタン

### 2. まとめ画面 (`/summary`)
- 全学習ページをテーブル形式で一覧表示
- タイトル検索機能
- タグによる絞り込み機能
- 検索結果件数表示

### 3. ページ編集画面 (`/page/new`, `/page/:id`)
- ページタイトル入力
- 樹形図エディター
- 内容入力エリア
- タグ選択機能
- 保存・削除ボタン

## データベース構造

### pages テーブル
- `id`: 主キー
- `title`: ページタイトル
- `content`: ページ内容
- `tree_data`: 樹形図データ（JSON）
- `created_at`: 作成日時
- `updated_at`: 更新日時

### tags テーブル
- `id`: 主キー
- `name`: タグ名
- `color`: タグの色
- `created_at`: 作成日時

### page_tags テーブル
- `id`: 主キー
- `page_id`: ページID（外部キー）
- `tag_id`: タグID（外部キー）

## API エンドポイント

### ページ関連
- `GET /api/pages` - ページ一覧取得（タグ情報含む）
- `GET /api/pages/:id` - 特定ページ取得（タグ情報含む）
- `POST /api/pages` - ページ作成
- `PUT /api/pages/:id` - ページ更新
- `DELETE /api/pages/:id` - ページ削除

### タグ関連
- `GET /api/tags` - タグ一覧取得
- `POST /api/tags` - タグ作成

## 開発

### 開発モードでの起動
```bash
# バックエンドのみ起動（開発用）
cd backend
npm install
npm run dev

# フロントエンドのみ起動（開発用）
cd frontend
npm install
npm start
```

### データベースの初期化
データベースは初回起動時に `database/init.sql` によって自動的に初期化されます。
初期データとして以下のタグが作成されます：
- 数学（赤色）
- プログラミング（緑色）
- 英語（紫色）
- 物理（黄色）

## トラブルシューティング

### ポートが使用中の場合
```bash
# 使用中のポートを確認
lsof -i :3000
lsof -i :3001
lsof -i :5432

# Docker Composeを停止
docker-compose down
```

### データベース接続エラー
```bash
# コンテナの状態を確認
docker-compose ps

# データベースログを確認
docker-compose logs postgres
```

### データのリセット
```bash
# 全てのコンテナとボリュームを削除
docker-compose down -v
docker-compose up --build
```

### 検索・フィルター機能が動作しない場合
```bash
# フロントエンドのログを確認
docker-compose logs frontend

# バックエンドAPIの動作確認
curl http://localhost:3001/api/pages
curl http://localhost:3001/api/tags
```

## 新機能の特徴

### まとめ画面の利点
- **効率的な管理**: 全ページを一覧で確認可能
- **高速検索**: タイトルやタグによる即座の絞り込み
- **視覚的整理**: テーブル形式による情報の構造化
- **レスポンシブ対応**: モバイルデバイスでも使いやすい表示

### 検索機能の特徴
- **リアルタイム検索**: 入力と同時に結果が更新
- **複合条件**: タイトル検索とタグ絞り込みの組み合わせ
- **直感的UI**: クリアボタンによる簡単リセット
- **件数表示**: 検索結果の数を明確に表示

## ライセンス

MIT License